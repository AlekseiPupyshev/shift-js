<!DOCTYPE html>

<html>
<head>
  <title>parser.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="command.html">
                  command.js
                </a>
              
                
                <a class="source" href="api.html">
                  api.js
                </a>
              
                
                <a class="source" href="lexer.html">
                  lexer.js
                </a>
              
                
                <a class="source" href="parser.html">
                  parser.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>parser.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> originalScope = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalScope'</span>);
<span class="hljs-keyword">var</span> tokenTypes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./tokenTypes'</span>);

<span class="hljs-comment">/**
 * Look forward one token in the collection
 */</span>
<span class="hljs-keyword">var</span> advance = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, id</span>) </span>{

  <span class="hljs-keyword">var</span> a, o, t, v;

  <span class="hljs-keyword">if</span> (id &amp;&amp; state.token.id !== id) {
    state.token.error(<span class="hljs-string">"Expected '"</span> + id + <span class="hljs-string">"'."</span>);
  }

  <span class="hljs-keyword">if</span> (state.index &gt;= state.tokens.length) {
    state.token = state.symbolTable[<span class="hljs-string">"(end)"</span>];
    <span class="hljs-keyword">return</span> state;
  }

  t = state.tokens[state.index];
  state.index += <span class="hljs-number">1</span>;
  v = t.value;
  a = t.type;

  <span class="hljs-keyword">if</span> (tokenTypes.noun.hasItem(a)) {
    <span class="hljs-keyword">if</span> (a === <span class="hljs-string">"DECLARATION_KEYWORD"</span> &amp;&amp; (v === <span class="hljs-string">"var"</span> || v === <span class="hljs-string">"let"</span>)) {
      v = <span class="hljs-string">"var"</span>;
    }
    o = state.scope.find(v, state.symbolTable);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tokenTypes.collectionStart.hasItem(a)) {

    <span class="hljs-keyword">if</span>(a === <span class="hljs-string">"ARRAY_START"</span>) {
      v = <span class="hljs-string">'['</span>;
      o = state.symbolTable[<span class="hljs-string">'['</span>];
    } <span class="hljs-keyword">else</span> {
      v = <span class="hljs-string">'{'</span>;
      o = state.symbolTable[<span class="hljs-string">'{'</span>];
    }

    <span class="hljs-keyword">if</span> (!o) {
      t.error(<span class="hljs-string">"Unknown operator."</span>);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tokenTypes.terminator.hasItem(a) || tokenTypes.verb.hasItem(a)) {
    o = state.symbolTable[v];
    <span class="hljs-keyword">if</span> (!o) {
      t.error(<span class="hljs-string">"Unknown operator."</span>);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tokenTypes.primitive.hasItem(a)) {
    o = state.symbolTable[<span class="hljs-string">"(literal)"</span>];
    a = <span class="hljs-string">"literal"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(tokenTypes.comment.hasItem(a)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  } <span class="hljs-keyword">else</span> {
    t.error(<span class="hljs-string">"Unexpected token."</span>);
  }

  state.token = <span class="hljs-built_in">Object</span>.create(o);
  state.token.value = v;
  state.token.type = a;

  <span class="hljs-keyword">return</span> state;

};

<span class="hljs-built_in">module</span>.exports = advance;
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);
<span class="hljs-keyword">var</span> infixr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./infixr'</span>);

<span class="hljs-keyword">var</span> assignment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, id</span>) </span>{
  <span class="hljs-keyword">return</span> infixr(state, id, <span class="hljs-number">10</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
    <span class="hljs-keyword">if</span>(left.id) {
      <span class="hljs-keyword">if</span> (left.id !== <span class="hljs-string">"+="</span> &amp;&amp; left.id !== <span class="hljs-string">"."</span> &amp;&amp; left.id !== <span class="hljs-string">"["</span> &amp;&amp; left.type !== <span class="hljs-string">"name"</span> &amp;&amp; left.id !== <span class="hljs-string">"(name)"</span>) {
        left.error(<span class="hljs-string">"Bad lvalue."</span>);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(left.type) {
      <span class="hljs-keyword">if</span>(left.type !== <span class="hljs-string">"IDENTIFIER"</span>) {
        left.error(<span class="hljs-string">"Bad lvalue."</span>);
      }
    }
    left.type = <span class="hljs-string">"Identifier"</span>;
    left.name = left.value;;
    <span class="hljs-keyword">delete</span> left.value;
    <span class="hljs-keyword">this</span>.left = left;
    <span class="hljs-keyword">this</span>.right = expression(state, <span class="hljs-number">9</span>);
    <span class="hljs-keyword">this</span>.assignment = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.operator = <span class="hljs-keyword">this</span>.value;
    <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"AssignmentExpression"</span>;
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  });
};

<span class="hljs-built_in">module</span>.exports = assignment;

<span class="hljs-keyword">var</span> advance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./advance'</span>);

<span class="hljs-keyword">var</span> block = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
  <span class="hljs-keyword">var</span> t = state.token;
  state = advance(state, <span class="hljs-string">"{"</span>);
  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
    state = advance(state);
  }
  <span class="hljs-keyword">var</span> stdReturnVal = t.std();
  <span class="hljs-keyword">var</span> blockStmtChildNode;

  <span class="hljs-comment">/* Logic as to whether statement node needs a parent node wrapper */</span>
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Array</span>.isArray(stdReturnVal)) {
    blockStmtChildNode = stdReturnVal;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>([<span class="hljs-string">"IfStatement"</span>, <span class="hljs-string">"ReturnStatement"</span>, <span class="hljs-string">"ForStatement"</span>].hasItem(stdReturnVal.type)) {
    blockStmtChildNode = stdReturnVal;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(stdReturnVal.type !== <span class="hljs-string">"ExpressionStatement"</span>) {
    blockStmtChildNode = {
      type: <span class="hljs-string">'ExpressionStatement'</span>,
      expression: stdReturnVal
    };
  }
  <span class="hljs-keyword">else</span> {
    blockStmtChildNode = stdReturnVal;
  }

  <span class="hljs-keyword">var</span> blockStmt = { type: <span class="hljs-string">'BlockStatement'</span> };
  blockStmt.body = (<span class="hljs-built_in">Array</span>.isArray(blockStmtChildNode)) ? blockStmtChildNode : [blockStmtChildNode];

  <span class="hljs-keyword">return</span> blockStmt;
};

<span class="hljs-built_in">module</span>.exports = block;
<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);

<span class="hljs-keyword">var</span> constant = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, s, v</span>) </span>{
  <span class="hljs-keyword">var</span> x = symbol(state, originalSymbol, s);
  x.nud = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    state.scope.reserve(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.value = symbolTable[<span class="hljs-keyword">this</span>.id].value;
    <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"literal"</span>;<span class="hljs-comment">//TODO "literal" -&gt; "Literal"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };
  x.value = v;
  <span class="hljs-keyword">return</span> x;
};

<span class="hljs-built_in">module</span>.exports = constant;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> diff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'deep-diff'</span>).diff;
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions.js'</span>);
<span class="hljs-keyword">var</span> advance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./advance'</span>);
<span class="hljs-keyword">var</span> newScope = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./newScope'</span>);
<span class="hljs-keyword">var</span> originalScope = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalScope'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);
<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> block = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./block'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);
<span class="hljs-keyword">var</span> infix = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./infix'</span>);
<span class="hljs-keyword">var</span> infixr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./infixr'</span>);
<span class="hljs-keyword">var</span> assignment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./assignment'</span>);
<span class="hljs-keyword">var</span> prefix = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./prefix'</span>);
<span class="hljs-keyword">var</span> stmt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./stmt'</span>);
<span class="hljs-keyword">var</span> statements = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./statements'</span>);
<span class="hljs-keyword">var</span> statement = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./statement'</span>);

<span class="hljs-keyword">var</span> declarations = {
  symbols: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
    symbol(state, originalSymbol, <span class="hljs-string">"EOF"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"\n"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"\\n"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"(end)"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"(name)"</span>).nud = helpers.itself;
    symbol(state, originalSymbol, <span class="hljs-string">":"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">";"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">")"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"]"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"}"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">","</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"else"</span>);
    symbol(state, originalSymbol, <span class="hljs-string">"(literal)"</span>).nud = helpers.itself;
    symbol(state, originalSymbol, <span class="hljs-string">"this"</span>).nud = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      state.scope.reserve(<span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"this"</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
  },

  assignments: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
    assignment(state, <span class="hljs-string">"="</span>);
    assignment(state, <span class="hljs-string">"+="</span>);
    assignment(state, <span class="hljs-string">"-="</span>);
    assignment(state, <span class="hljs-string">"*="</span>);
    assignment(state, <span class="hljs-string">"/="</span>);
  },

  infixes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
    infix(state, <span class="hljs-string">"?"</span>, <span class="hljs-number">20</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ConditionalExpression"</span>;
      <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        left.type = <span class="hljs-string">"Identifier"</span>;
        left.name = left.value;
        <span class="hljs-keyword">delete</span> left.value;
      }
      <span class="hljs-keyword">this</span>.test = left;
      <span class="hljs-keyword">this</span>.consequent = expression(state, <span class="hljs-number">0</span>);
      state = advance(state, <span class="hljs-string">":"</span>);
      <span class="hljs-keyword">this</span>.alternate = expression(state, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    infixr(state, <span class="hljs-string">"&amp;&amp;"</span>, <span class="hljs-number">30</span>);
    infixr(state, <span class="hljs-string">"||"</span>, <span class="hljs-number">30</span>);
    infixr(state, <span class="hljs-string">"==="</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"=="</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"!=="</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"!="</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"&lt;"</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"&lt;="</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"&gt;"</span>, <span class="hljs-number">40</span>);
    infixr(state, <span class="hljs-string">"&gt;="</span>, <span class="hljs-number">40</span>);
    infix(state, <span class="hljs-string">"+"</span>, <span class="hljs-number">50</span>);
    infix(state, <span class="hljs-string">"-"</span>, <span class="hljs-number">50</span>);
    infix(state, <span class="hljs-string">"*"</span>, <span class="hljs-number">60</span>);
    infix(state, <span class="hljs-string">"/"</span>, <span class="hljs-number">60</span>);
    infix(state, <span class="hljs-string">"%"</span>, <span class="hljs-number">60</span>);

    infix(state, <span class="hljs-string">"."</span>, <span class="hljs-number">80</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>this.first = left;//TODO other change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"MemberExpression"</span>;
      <span class="hljs-keyword">this</span>.computed = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.object = left;<span class="hljs-comment">// object: { value: 'Array', type: 'IDENTIFIER' },</span>
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.object.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        <span class="hljs-keyword">this</span>.object.type = <span class="hljs-string">"Identifier"</span>;
        <span class="hljs-keyword">this</span>.object.name = <span class="hljs-keyword">this</span>.object.value;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.object.value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.object.type === <span class="hljs-string">"MemberExpression"</span>) {
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>want  object: { type: ‘Identifier’, name: ‘Array’ },</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (state.token.type !== <span class="hljs-string">"IDENTIFIER"</span>) {
        state.token.error(<span class="hljs-string">"Expected a property name."</span>);
      }
      <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        state.token.type = <span class="hljs-string">"Identifier"</span>;
        state.token.name = state.token.value;
        <span class="hljs-keyword">delete</span> state.token.value;
      }
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.name;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;<span class="hljs-comment">//'.'</span>
      <span class="hljs-keyword">this</span>.property = state.token;
      state = advance(state);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    infix(state, <span class="hljs-string">"["</span>, <span class="hljs-number">80</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"MemberExpression"</span>;
      <span class="hljs-keyword">this</span>.computed = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">'IDENTIFIER'</span>){
        left.name = left.value;
        left.type = <span class="hljs-string">"Identifier"</span>;
        <span class="hljs-keyword">delete</span> left.value;
      }
      <span class="hljs-keyword">this</span>.object = left;
      <span class="hljs-keyword">this</span>.property = expression(state, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      state = advance(state, <span class="hljs-string">"]"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    infix(state, <span class="hljs-string">"("</span>, <span class="hljs-number">80</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
      <span class="hljs-keyword">var</span> a = [], parentParentNode;
      <span class="hljs-keyword">if</span> (left.id === <span class="hljs-string">"."</span> || left.id === <span class="hljs-string">"["</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"MemberExpression"</span>;
        <span class="hljs-keyword">this</span>.computed = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">this</span>.object = left.object;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>this.object.name = this.object.value;//TODO Add logic, sometimes necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.object.value;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>this.object.type = “Identifier”;//TODO Needs to go (at least in this case)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.property = left.property;
        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.property.name) {
          <span class="hljs-keyword">this</span>.property.name = <span class="hljs-keyword">this</span>.property.value;
        }
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.property.value;
        <span class="hljs-keyword">this</span>.property.type = <span class="hljs-string">"Identifier"</span>;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.property.arity;

        parentParentNode = {
          type: <span class="hljs-string">'ExpressionStatement'</span>,
          expression: {
            type: <span class="hljs-string">'CallExpression'</span>,
            callee: <span class="hljs-keyword">this</span>,
            <span class="hljs-built_in">arguments</span>: a
          }
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.object = left;
        <span class="hljs-keyword">this</span>.arguments = a;
        <span class="hljs-keyword">if</span> ((left.arity !== <span class="hljs-string">"unary"</span> || left.id !== <span class="hljs-string">"function"</span>) &amp;&amp;
          left.type !== <span class="hljs-string">"IDENTIFIER"</span> &amp;&amp; left.id !== <span class="hljs-string">"("</span> &amp;&amp;
          left.id !== <span class="hljs-string">"&amp;&amp;"</span> &amp;&amp; left.id !== <span class="hljs-string">"||"</span> &amp;&amp; left.id !== <span class="hljs-string">"?"</span>) {
          left.error(<span class="hljs-string">"Expected a variable name."</span>);
        }

        parentParentNode = <span class="hljs-keyword">this</span>;

      }

      <span class="hljs-comment">/*TODO add logic checking for invocation parameter naming, ex (day: "Tuesday")*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Are swift params order dependent??</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">")"</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {

          <span class="hljs-keyword">var</span> lookAheadOne = state.tokens[state.index];
          <span class="hljs-keyword">if</span>(lookAheadOne.value === <span class="hljs-string">":"</span>) {
            state = advance(state);
            state = advance(state);
          }

          a.push(expression(state, <span class="hljs-number">0</span>));

          <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
            <span class="hljs-keyword">break</span>;
          }
          state = advance(state, <span class="hljs-string">","</span>);
        }
      }
      state = advance(state, <span class="hljs-string">")"</span>);
      <span class="hljs-keyword">return</span> parentParentNode;
    });
  },

  prefixes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
    prefix(state, <span class="hljs-string">"+"</span>);
    prefix(state, <span class="hljs-string">"!"</span>);
    prefix(state, <span class="hljs-string">"++"</span>);
    prefix(state, <span class="hljs-string">"--"</span>);
    prefix(state, <span class="hljs-string">"-"</span>);
    prefix(state, <span class="hljs-string">"typeof"</span>);

    prefix(state, <span class="hljs-string">"("</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> e = expression(state, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
      state = advance(state, <span class="hljs-string">")"</span>);
      <span class="hljs-keyword">return</span> e;
    });

    prefix(state, <span class="hljs-string">"func"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> a = [];
      state.scope = newScope(state, originalScope);
      <span class="hljs-keyword">if</span> (state.token.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        state.scope.define(state, state.token);
        <span class="hljs-keyword">this</span>.name = state.token.value;
        state = advance(state);
      }
      state = advance(state, <span class="hljs-string">"("</span>);
      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">")"</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"var"</span>) {
            state = advance(state);
          }
          <span class="hljs-keyword">if</span> (state.token.type !== <span class="hljs-string">"IDENTIFIER"</span>) {
            state.token.error(<span class="hljs-string">"Expected a parameter name."</span>);
          }
          state.scope.define(state, state.token);
          state.token.type = <span class="hljs-string">"Identifier"</span>;
          state.token.name = state.token.value;
          <span class="hljs-keyword">delete</span> state.token.value;

          a.push(state.token);
          state = advance(state);
          <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">":"</span>) {

            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
              <span class="hljs-keyword">if</span> (state.token.value !== <span class="hljs-string">','</span> &amp;&amp; state.token.value !== <span class="hljs-string">'{'</span>) {
                state = advance(state);
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;
              }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>state = advance(state);
state = advance(state);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
          }
          <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
            <span class="hljs-keyword">break</span>;
          }
          state = advance(state, <span class="hljs-string">","</span>);
        }
      }

      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">")"</span>) {
        state = advance(state, <span class="hljs-string">")"</span>);
      }
      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"-&gt;"</span>) {
        state = advance(state);
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          <span class="hljs-keyword">if</span> (state.token.value !== <span class="hljs-string">'{'</span>) {
            state = advance(state);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">break</span>;
          }
        }
      }

      state = advance(state, <span class="hljs-string">"{"</span>);

      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }

      <span class="hljs-comment">/* TODO Hacky solution to 'let a = a + 1' when a has already been defined as a parameter to function signature. */</span>

      <span class="hljs-keyword">var</span> tmpLookAhead = state.tokens[state.index];
      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"var"</span>) {
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> p=<span class="hljs-number">0</span>; p&lt;a.length; p++) {
          <span class="hljs-keyword">var</span> param = a[p];
          <span class="hljs-keyword">var</span> paramIdentity = param.name;
          <span class="hljs-keyword">if</span>(tmpLookAhead.value === paramIdentity) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>TODO delete item from scope so it can be re-added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            state.scope.delete(state, tmpLookAhead);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>remove var token from tokens array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            state.tokens.splice(state.index - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

            <span class="hljs-keyword">var</span> t = state.tokens[state.index - <span class="hljs-number">1</span>];
            <span class="hljs-keyword">var</span> tmpVar = state.scope.find(t.value, state.symbolTable);
            <span class="hljs-keyword">var</span> tmpSymb = <span class="hljs-built_in">Object</span>.create(tmpVar);
            tmpSymb.value = t.value;
            tmpSymb.type = t.type;
            state.token = tmpSymb;
          }
        }
      }

      <span class="hljs-keyword">var</span> fnBody = statements(state);

      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }

      state = advance(state, <span class="hljs-string">"}"</span>);

      <span class="hljs-keyword">var</span> fnBodyArray = <span class="hljs-built_in">Array</span>.isArray(fnBody) ? fnBody : [fnBody];

      <span class="hljs-keyword">if</span>(fnBodyArray.length&gt;<span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> w=<span class="hljs-number">0</span>; w&lt;fnBodyArray.length; w++) {
          <span class="hljs-keyword">var</span> bodyStmt = fnBodyArray[w];
          <span class="hljs-keyword">if</span>(bodyStmt.type === <span class="hljs-string">"CallExpression"</span>) {
            <span class="hljs-keyword">var</span> expressionStmtWrapper = {
              type: <span class="hljs-string">'ExpressionStatement'</span>,
              expression: bodyStmt
            };
            fnBodyArray[w] = expressionStmtWrapper;
          }
        }
      }

      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"FunctionDeclaration"</span>;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">this</span>.id = {
        type: <span class="hljs-string">"Identifier"</span>,
        name: <span class="hljs-keyword">this</span>.name
      };
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.name;
      <span class="hljs-keyword">this</span>.params = a;
      <span class="hljs-keyword">this</span>.defaults = [];
      <span class="hljs-keyword">this</span>.body = {
        type: <span class="hljs-string">'BlockStatement'</span>,
        body: fnBodyArray
      };
      <span class="hljs-keyword">this</span>.generator = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.expression = <span class="hljs-literal">false</span>;
      state.scope.pop();
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    prefix(state, <span class="hljs-string">"["</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> a = [];
      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">"]"</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          a.push(expression(state, <span class="hljs-number">0</span>));
          <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
            <span class="hljs-keyword">break</span>;
          }
          state = advance(state, <span class="hljs-string">","</span>);
        }
      }
      state = advance(state, <span class="hljs-string">"]"</span>);
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ArrayExpression"</span>;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.raw;
      <span class="hljs-keyword">this</span>.elements = a;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    prefix(state, <span class="hljs-string">"{"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> a = [], n, v;

      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }

      <span class="hljs-comment">/**
       * Currently only handles collections
       * TODO Extend to also include function bodies?
       */</span>

      <span class="hljs-keyword">var</span> tmpLookAhead = state.tokens[state.index];
      <span class="hljs-keyword">if</span>(tmpLookAhead.type === <span class="hljs-string">"DICTIONARY_END"</span>) {
        state = advance(state);
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ObjectExpression"</span>;
        <span class="hljs-keyword">this</span>.properties = [];
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.raw;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }
      <span class="hljs-keyword">if</span>(tmpLookAhead.value === <span class="hljs-string">","</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Handle Tuples w/out keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> a = [];
        <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">"]"</span>) {
          <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            a.push(expression(state, <span class="hljs-number">0</span>));
            <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
              <span class="hljs-keyword">break</span>;
            }
            state = advance(state, <span class="hljs-string">","</span>);
          }
        }
        state = advance(state, <span class="hljs-string">")"</span>);
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ObjectExpression"</span>;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.raw;
        <span class="hljs-keyword">this</span>.properties = [];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> m=<span class="hljs-number">0</span>; m&lt;a.length; m++) {
          <span class="hljs-keyword">var</span> currentValue = a[m];
          <span class="hljs-keyword">var</span> kvMap = {};
          kvMap.type = <span class="hljs-string">"Property"</span>;
          kvMap.computed = <span class="hljs-literal">false</span>;
          kvMap.kind = <span class="hljs-string">'init'</span>;
          kvMap.method = <span class="hljs-literal">false</span>;
          kvMap.shorthand = <span class="hljs-literal">false</span>;
          kvMap.key = {};
          kvMap.key.type = <span class="hljs-string">"Literal"</span>;
          <span class="hljs-keyword">var</span> keyIndex = <span class="hljs-keyword">this</span>.properties.length;
          kvMap.key.value = keyIndex;
          kvMap.key.raw = keyIndex.toString();
          kvMap.value = currentValue;
          <span class="hljs-keyword">this</span>.properties.push(kvMap);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }
      <span class="hljs-comment">/* Get all things in dictionary */</span>
      <span class="hljs-keyword">if</span> ((state.token.id !== <span class="hljs-string">"]"</span> &amp;&amp;  state.token.id !== <span class="hljs-string">")"</span>) &amp;&amp; tmpLookAhead.value !== <span class="hljs-string">","</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          n = state.token;
          <span class="hljs-comment">/* if  */</span>
          <span class="hljs-keyword">if</span> (n.type !== <span class="hljs-string">"IDENTIFIER"</span> &amp;&amp; n.type !== <span class="hljs-string">"literal"</span> &amp;&amp; n.type !== <span class="hljs-string">"TUPLE_ELEMENT_NAME"</span>) {
            state.token.error(<span class="hljs-string">"Bad property name."</span>);
          }
          state = advance(state);
          state = advance(state, <span class="hljs-string">":"</span>);
          v = expression(state, <span class="hljs-number">0</span>);

          <span class="hljs-keyword">var</span> kvMap = {};
          kvMap.type = <span class="hljs-string">"Property"</span>;
          kvMap.computed = <span class="hljs-literal">false</span>;
          kvMap.kind = <span class="hljs-string">'init'</span>;
          kvMap.method = <span class="hljs-literal">false</span>;
          kvMap.shorthand = <span class="hljs-literal">false</span>;

          <span class="hljs-keyword">if</span> (n.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isNum(n.value)) {
            n.type = <span class="hljs-string">"Literal"</span>;
            n.raw = n.value;
            <span class="hljs-keyword">if</span> (n.value.indexOf(<span class="hljs-string">'.'</span>)) {
              n.value = <span class="hljs-built_in">parseFloat</span>(n.value);
            } <span class="hljs-keyword">else</span> {
              n.value = <span class="hljs-built_in">parseInt</span>(n.value);
            }
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isBool(n.value)) {
            n.type = <span class="hljs-string">"Identifier"</span>;
            n.name = n.value;
            <span class="hljs-keyword">delete</span> n.raw;
            <span class="hljs-keyword">delete</span> n.value;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n.type === <span class="hljs-string">"literal"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>This is for type string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            n.type = <span class="hljs-string">"Literal"</span>;
            n.raw = <span class="hljs-string">'"'</span> + n.value + <span class="hljs-string">'"'</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n.type === <span class="hljs-string">"TUPLE_ELEMENT_NAME"</span>) {
            n.type = <span class="hljs-string">"Identifier"</span>;
            n.name = n.value;
            <span class="hljs-keyword">delete</span> n.value;
          }
          kvMap.key = n;
          kvMap.value = v;

          <span class="hljs-comment">/* a.push(v); */</span>
          a.push(kvMap);

          <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
            <span class="hljs-keyword">break</span>;
          }

          <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
              state = advance(state);
            }
            <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">break</span>;
            }
          }

          state = advance(state, <span class="hljs-string">","</span>);

          <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
              state = advance(state);
            }
            <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">break</span>;
            }
          }

          <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"DICTIONARY_END"</span>) {
            <span class="hljs-keyword">break</span>;
          }
        }
      }

      <span class="hljs-keyword">try</span> {
        state = advance(state, <span class="hljs-string">"]"</span>);<span class="hljs-comment">//TODO just one here</span>
      } <span class="hljs-keyword">catch</span>(e) {
        state = advance(state, <span class="hljs-string">")"</span>);
      }

      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"unary"</span>;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ObjectExpression"</span>;
      <span class="hljs-keyword">this</span>.properties = a;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });
  },

  stmts: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
    stmt(state, <span class="hljs-string">"{"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      state.scope = newScope(state, originalScope);
      <span class="hljs-keyword">var</span> a = statements(state);
      state = advance(state, <span class="hljs-string">"}"</span>);
      state.scope.pop();
      <span class="hljs-keyword">return</span> a;
    });

    stmt(state, <span class="hljs-string">"var"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> a = [], n, t;
      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        n = state.token;
        <span class="hljs-keyword">if</span> (n.type !== <span class="hljs-string">"IDENTIFIER"</span>) {
          n.error(<span class="hljs-string">"Expected a new variable identifier."</span>);
        } <span class="hljs-keyword">else</span> {
          n.type = <span class="hljs-string">"Identifier"</span>;
          n.name = n.value;
        }

        state.scope.define(state, n);
        <span class="hljs-keyword">delete</span> n.value;

        state = advance(state);

        <span class="hljs-comment">/* Type Declarations */</span>
        <span class="hljs-keyword">if</span>(state.token.id === <span class="hljs-string">":"</span>) {
          state = advance(state, <span class="hljs-string">":"</span>);
          <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"TYPE_STRING"</span>) {
            state = advance(state);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"TYPE_NUMBER"</span>) {
            state = advance(state);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"TYPE_BOOLEAN"</span>) {
            state = advance(state);
          }
        }

        <span class="hljs-comment">/* Assignment to a variable declaration */</span>
        <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">"="</span>) {
          t = state.token;
          state = advance(state, <span class="hljs-string">"="</span>);

          t.type = <span class="hljs-string">'VariableDeclaration'</span>;
          t.kind = <span class="hljs-string">'var'</span>;
          t.declarations = [{
            type: <span class="hljs-string">'VariableDeclarator'</span>,
            id: {},
            init: {}
          }];

          t.declarations[<span class="hljs-number">0</span>].id = n; <span class="hljs-comment">//TODO FIX</span>
          t.declarations[<span class="hljs-number">0</span>].init = expression(state, <span class="hljs-number">0</span>);
          <span class="hljs-keyword">delete</span> t.value;

          a.push(t);
        }
        <span class="hljs-comment">/* Uninitialized variable declaration */</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-string">";"</span>, <span class="hljs-string">")"</span>].hasItem(state.token.id)) {
          t = state.token;
          t.type = <span class="hljs-string">'VariableDeclaration'</span>;
          t.kind = <span class="hljs-string">'var'</span>;
          t.declarations = [{
            type: <span class="hljs-string">'VariableDeclarator'</span>,
            id: {},
            init: {}
          }];
          t.declarations[<span class="hljs-number">0</span>].id = n;
          t.declarations[<span class="hljs-number">0</span>].init = <span class="hljs-literal">null</span>;
          <span class="hljs-keyword">delete</span> t.value;

          a.push(t);
          <span class="hljs-keyword">if</span>(state.token.id === <span class="hljs-string">";"</span>) {
            state = advance(state);
          }
          <span class="hljs-keyword">break</span>;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"TERMINATOR"</span>) {
          state = advance(state);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>TODO maybe check for newlines here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span>(state.token.id === <span class="hljs-string">";"</span>) {
          state = advance(state);
        }

        <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">","</span>) {
          <span class="hljs-keyword">break</span>;
        }
        state = advance(state, <span class="hljs-string">","</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>TODO outside of the while loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">if</span>([<span class="hljs-string">";"</span>, <span class="hljs-string">"var"</span>, <span class="hljs-string">"if"</span>, <span class="hljs-string">"while"</span>, <span class="hljs-string">"repeat"</span>, <span class="hljs-string">"for"</span>, <span class="hljs-string">"++"</span>, <span class="hljs-string">"--"</span>].hasItem(state.token.value)) {
        <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.token.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
        <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
      }

      state = advance(state);

      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"var"</span>) {
        <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>if(state.token.value === “\n”) {
 state = advance(state);
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }
      <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
    });

    stmt(state, <span class="hljs-string">"if"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

      state = advance(state, <span class="hljs-string">"("</span>);
      <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.test.type === <span class="hljs-string">"ExpressionStatement"</span>) {
        <span class="hljs-keyword">this</span>.test = <span class="hljs-keyword">this</span>.test.expression;
      }
      state = advance(state, <span class="hljs-string">")"</span>);

      <span class="hljs-keyword">this</span>.consequent = block(state);

      <span class="hljs-comment">/* block directly followed by else or else if statement? */</span>
      <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">"else"</span>) {
        state.scope.reserve(state.token);
        state = advance(state, <span class="hljs-string">"else"</span>);
        <span class="hljs-keyword">this</span>.alternate = state.token.id === <span class="hljs-string">"if"</span> ? statement(state) : block(state);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.alternate = <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"IfStatement"</span>;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    stmt(state, <span class="hljs-string">"return"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">";"</span>) {
        <span class="hljs-keyword">this</span>.argument = expression(state, <span class="hljs-number">0</span>);
      }

      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }

      <span class="hljs-keyword">if</span>(state.token.id === <span class="hljs-string">";"</span>) {
        state = advance(state, <span class="hljs-string">";"</span>);
      }

      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
          state = advance(state);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
      }

      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">"}"</span>) {
        state.token.error(<span class="hljs-string">"Unreachable statement."</span>);
      }

      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ReturnStatement"</span>;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;

      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.argument.type === <span class="hljs-string">"ExpressionStatement"</span> &amp;&amp; <span class="hljs-keyword">this</span>.argument.expression.type === <span class="hljs-string">"CallExpression"</span>) {
        <span class="hljs-keyword">this</span>.argument = <span class="hljs-keyword">this</span>.argument.expression;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    stmt(state, <span class="hljs-string">"break"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      state = advance(state, <span class="hljs-string">";"</span>);
      <span class="hljs-keyword">if</span> (state.token.id !== <span class="hljs-string">"}"</span>) {
        state.token.error(<span class="hljs-string">"Unreachable statement."</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    stmt(state, <span class="hljs-string">"while"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"WhileStatement"</span>;
      <span class="hljs-keyword">if</span>(state.tokens[state.index-<span class="hljs-number">1</span>].value === <span class="hljs-string">"("</span>) {
        state = advance(state, <span class="hljs-string">"("</span>);
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
        state = advance(state, <span class="hljs-string">")"</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
      }
      <span class="hljs-keyword">this</span>.body = block(state);
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    stmt(state, <span class="hljs-string">"for"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ForStatement"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO Refactor For Statements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-comment">/* for( var identifier) 'in' identifier { .. } */</span>
      <span class="hljs-comment">/* to distinguish this if from conventional for-loop below */</span>
      <span class="hljs-keyword">if</span>(state.tokens[state.index-<span class="hljs-number">1</span>].value === <span class="hljs-string">"("</span> &amp;&amp; state.tokens[state.index+<span class="hljs-number">2</span>].value === <span class="hljs-string">")"</span>) {

        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ForInStatement"</span>
        <span class="hljs-keyword">if</span> (state.token.value === <span class="hljs-string">"("</span>) {
          state = advance(state);
        }
        <span class="hljs-keyword">this</span>.left = statements(state, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>state.token.value === “in”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        state = advance(state);
        <span class="hljs-keyword">this</span>.each = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.right = {};
        <span class="hljs-keyword">this</span>.right.type = <span class="hljs-string">"Identifier"</span>;
        <span class="hljs-keyword">this</span>.right.name = state.token.value;
        state = advance(state);
      }
      <span class="hljs-comment">/* for( var identifier..;exp;exp) { } */</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.tokens[state.index-<span class="hljs-number">1</span>].value === <span class="hljs-string">"("</span>) {
        state = advance(state, <span class="hljs-string">"("</span>);
        <span class="hljs-keyword">this</span>.init = statements(state, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">";"</span>) {
          state = advance(state, <span class="hljs-string">";"</span>);
        }
        <span class="hljs-keyword">this</span>.update = expression(state, <span class="hljs-number">0</span>);
        state = advance(state, <span class="hljs-string">")"</span>);
      }
      <span class="hljs-comment">/* for KEYWORD_DECLARATION IDENTIFIER "IN" IDENTIFIER { } */</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state.tokens[state.index-<span class="hljs-number">1</span>].type === <span class="hljs-string">"IDENTIFIER"</span> &amp;&amp; state.tokens[state.index+<span class="hljs-number">1</span>].type === <span class="hljs-string">"IDENTIFIER"</span>) {

        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"ForInStatement"</span>;

        <span class="hljs-comment">/* Splice in a var keyword */</span>
        <span class="hljs-keyword">var</span> symbVar = state.symbolTable[<span class="hljs-string">"var"</span>];
        <span class="hljs-keyword">var</span> tkVar = <span class="hljs-built_in">Object</span>.create(symbVar);
        tkVar.value = <span class="hljs-string">"var"</span>;
        tkVar.type = <span class="hljs-string">"DECLARATION_KEYWORD"</span>;
        state.tokens.splice(state.index-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, tkVar);
        state.token = state.tokens[state.index-<span class="hljs-number">1</span>];

        <span class="hljs-comment">/* Splice in an end parens */</span>
        <span class="hljs-keyword">var</span> symbEndParen = state.symbolTable[<span class="hljs-string">")"</span>];
        <span class="hljs-keyword">var</span> tkEndParen = <span class="hljs-built_in">Object</span>.create(symbEndParen);
        tkEndParen.value = <span class="hljs-string">")"</span>;
        tkEndParen.type = <span class="hljs-string">"PUNCTUATION"</span>;
        state.tokens.splice(state.index+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, tkEndParen);

        <span class="hljs-keyword">this</span>.left = statements(state, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);
        state = advance(state);
        <span class="hljs-keyword">this</span>.each = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.right = {};
        <span class="hljs-keyword">this</span>.right.type = <span class="hljs-string">"Identifier"</span>;
        <span class="hljs-keyword">this</span>.right.name = state.token.value;
        state = advance(state);

      } <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">this</span>.init = statements(state, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">";"</span>) {
          state = advance(state, <span class="hljs-string">";"</span>);
        }
        <span class="hljs-keyword">this</span>.update = expression(state, <span class="hljs-number">0</span>);
      }

      <span class="hljs-keyword">this</span>.body = block(state);
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

    stmt(state, <span class="hljs-string">"repeat"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"DoWhileStatement"</span>;
      <span class="hljs-keyword">this</span>.body = block(state);
      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">'while'</span>) {
        state = advance(state);
      }
      <span class="hljs-keyword">if</span>(state.tokens[state.index-<span class="hljs-number">1</span>].value === <span class="hljs-string">"("</span>) {
        state = advance(state, <span class="hljs-string">"("</span>);
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
        state = advance(state, <span class="hljs-string">")"</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.test = expression(state, <span class="hljs-number">0</span>);
      }
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">";"</span>) {
        state = advance(state);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    });

  },
  constants: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>constant(state, “true”, true);
constant(state, “false”, false);
constant(state, “null”, null);
constant(state, “pi”, 3.141592653589793);
constant(state, “Object”, {});
constant(state, “Array”, []);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }


};

<span class="hljs-built_in">module</span>.exports = declarations;
<span class="hljs-keyword">var</span> advance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./advance'</span>);
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions'</span>);

<span class="hljs-comment">/**
 * Begin parsing an expression phrase from the current token
 * Calls itself recursively depending on the context.
 **/</span>
<span class="hljs-keyword">var</span> expression = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, rbp, dontWrapBinExpNodeInExpStmtBool</span>) </span>{

  <span class="hljs-keyword">var</span> left;
  <span class="hljs-keyword">var</span> t = state.token;
  state = advance(state);
  left = t.nud();



  <span class="hljs-keyword">if</span> (t.value === <span class="hljs-string">"++"</span> || t.value === <span class="hljs-string">"--"</span>) {
    <span class="hljs-comment">/*Pre-fix operator*/</span>
    left = t;

    <span class="hljs-keyword">if</span>(state.token.value !== <span class="hljs-string">"}"</span> &amp;&amp; state.token.value !== <span class="hljs-string">"=="</span>) {
      state = advance(state);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state.token.value === <span class="hljs-string">"++"</span> || state.token.value === <span class="hljs-string">"--"</span>) {
    <span class="hljs-comment">/*Post-fix operators*/</span>
    <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"++"</span>) {
      left.type = <span class="hljs-string">"Identifier"</span>;
      left.name = left.value;
      <span class="hljs-keyword">delete</span> left.value;
      state = advance(state);
      <span class="hljs-keyword">var</span> tmpParentNode = {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"UpdateExpression"</span>,
        <span class="hljs-string">"operator"</span>: <span class="hljs-string">"++"</span>,
        <span class="hljs-string">"prefix"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"argument"</span>: left,
        assignment: <span class="hljs-literal">true</span>
      };
      left = tmpParentNode;
    } <span class="hljs-keyword">else</span> {
      left.type = <span class="hljs-string">"Identifier"</span>;
      left.name = left.value;
      <span class="hljs-keyword">delete</span> left.value;
      state = advance(state);
      <span class="hljs-keyword">var</span> tmpParentNode = {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"UpdateExpression"</span>,
        <span class="hljs-string">"operator"</span>: <span class="hljs-string">"--"</span>,
        <span class="hljs-string">"prefix"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"argument"</span>: left
      };
      left = tmpParentNode;
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.operator === <span class="hljs-string">"+"</span>) {
    <span class="hljs-keyword">delete</span> t.value;
    state.token.name = state.token.value;
    state.token.type = <span class="hljs-string">"Identifier"</span>;
    <span class="hljs-keyword">delete</span> state.token.value;
    t.argument = state.token;
  }

  <span class="hljs-comment">/**
   * Logic to handle the recursive case
   */</span>
  <span class="hljs-keyword">while</span> (rbp &lt; state.token.lbp) {
    t = state.token;
    state = advance(state);
    left = t.led(left);<span class="hljs-comment">//assignments</span>
  }


  <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"IDENTIFIER"</span>) {
    left.name = left.value;
    left.type = <span class="hljs-string">"Identifier"</span>;
    <span class="hljs-keyword">delete</span> left.value;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isNum(left.value)) {
    left.type = <span class="hljs-string">"Literal"</span>;
    left.raw = left.value;
    <span class="hljs-keyword">if</span> (left.value.indexOf(<span class="hljs-string">'.'</span>)) {
      left.value = <span class="hljs-built_in">parseFloat</span>(left.value);
    } <span class="hljs-keyword">else</span> {
      left.value = <span class="hljs-built_in">parseInt</span>(left.value);
    }
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isBool(left.value)) {
    left.type = <span class="hljs-string">"Literal"</span>;
    left.raw = t.value;
    left.value = t.value === <span class="hljs-string">"true"</span>;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span>) {
    left.type = <span class="hljs-string">"Literal"</span>;
    left.raw = <span class="hljs-string">'"'</span> + t.value + <span class="hljs-string">'"'</span>;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.operator === <span class="hljs-string">"="</span>) {
    <span class="hljs-keyword">var</span> expStmt = {};
    expStmt.type = <span class="hljs-string">"ExpressionStatement"</span>;

    <span class="hljs-keyword">if</span>(left.left.object &amp;&amp; left.left.property) {
      left.left.type = <span class="hljs-string">"MemberExpression"</span>;
      <span class="hljs-keyword">delete</span> left.left.name;
    }
    expStmt.expression = left;
    left = expStmt;
    left.assignment = <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.operator === <span class="hljs-string">"=="</span>) {

    <span class="hljs-keyword">if</span>(!dontWrapBinExpNodeInExpStmtBool) {
      <span class="hljs-keyword">var</span> expressionStmtNode = { type: <span class="hljs-string">'ExpressionStatement'</span> };
      expressionStmtNode.expression = left;
      left = expressionStmtNode;
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.operator === <span class="hljs-string">"==="</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.value === <span class="hljs-string">"."</span>) {
    state = advance(state);
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"INVOCATION_START"</span>) {
    <span class="hljs-keyword">delete</span> left.value;
    left.type = <span class="hljs-string">"CallExpression"</span>;
    left.callee = left.object;
    <span class="hljs-keyword">delete</span> left.object;
    <span class="hljs-keyword">if</span>(left.callee.type === <span class="hljs-string">"IDENTIFIER"</span>) {
      left.callee.type = <span class="hljs-string">"Identifier"</span>;
      left.callee.name = left.callee.value;
      <span class="hljs-keyword">delete</span> left.callee.value;
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"ExpressionStatement"</span>) {
    left = left.expression;
  }

  <span class="hljs-keyword">return</span> left;
};

<span class="hljs-built_in">module</span>.exports = expression;
<span class="hljs-comment">/**
 *
 */</span>

<span class="hljs-keyword">var</span> helpers = {
  deletePropertyIfExists : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, propertyArray</span>) </span>{
    <span class="hljs-keyword">if</span>(node !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; propertyArray.length; i++) {
        <span class="hljs-keyword">var</span> prop = propertyArray[i];
        <span class="hljs-keyword">var</span> hasProp = node.hasOwnProperty(prop);
        <span class="hljs-keyword">if</span> (hasProp) {
          <span class="hljs-keyword">delete</span> node[prop];
        }
      }
    }
  },
  <span class="hljs-comment">/**
   * Recursively walk a tree and apply a callback on each node
   */</span>
  traverse: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, func</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    func(node);
    <span class="hljs-keyword">if</span>(node !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (node.scope) {
        <span class="hljs-keyword">delete</span> node.scope;
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> node) {
        <span class="hljs-keyword">if</span> (node.hasOwnProperty(key)) {
          <span class="hljs-keyword">var</span> child = node[key];
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> child === <span class="hljs-string">'object'</span> &amp;&amp; child !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(child)) {
              child.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
                self.traverse(node, func);
              });
            } <span class="hljs-keyword">else</span> {
              self.traverse(child, func);
            }
          }
        }
      }
    }
  },
  <span class="hljs-comment">/**
   * Make initial pass through input token stream removing ambiguity of certain token permutations to the parser.
   * Example 1: Characters of pre- and post-fix increment &amp; decrement
   *        operators are lexed independently as separate operators.
   * Example 2: Swift, but not Javascript, allows for dynamic property
   *        look-ups within literal declarations of collections.
   **/</span>
  cleanUpTokenStream: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length; i++) {
      <span class="hljs-keyword">if</span> (input[i].type === <span class="hljs-string">"STRING_INTERPOLATION_START"</span> || input[i].type === <span class="hljs-string">"STRING_INTERPOLATION_END"</span>) {
        input[i].type = <span class="hljs-string">"OPERATOR"</span>;
        input[i].value = <span class="hljs-string">"+"</span>;
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"!"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">2</span>].value === <span class="hljs-string">"="</span>) {
            input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
            input[i].value = <span class="hljs-string">"!=="</span>;
            <span class="hljs-keyword">return</span> input;
          } <span class="hljs-keyword">else</span> {
            input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            input[i].value = <span class="hljs-string">"!="</span>;
          }
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"="</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">2</span>].value === <span class="hljs-string">"="</span>) {
            input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
            input[i].value = <span class="hljs-string">"==="</span>;
          } <span class="hljs-keyword">else</span> {
            input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            input[i].value = <span class="hljs-string">"=="</span>;
          }
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"+"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"+"</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"++"</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"-"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"-"</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"--"</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"|"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"|"</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"||"</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"&gt;"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"&gt;="</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"&lt;"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"&lt;="</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"*"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"*="</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"/"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"/="</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"+"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"+="</span>;
        }
      }
      <span class="hljs-keyword">if</span> (input[i].value === <span class="hljs-string">"-"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].value === <span class="hljs-string">"="</span>) {
          input.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
          input[i].value = <span class="hljs-string">"-="</span>;
        }
      }

      <span class="hljs-comment">/* Remove inline comments */</span>
      <span class="hljs-keyword">if</span> (input[i].type === <span class="hljs-string">"COMMENT_START"</span>) {
        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">1</span>].type === <span class="hljs-string">"COMMENT"</span>) {
          input.splice(i, <span class="hljs-number">2</span>);
        }
      }
      <span class="hljs-comment">/* Remove multi-line comments */</span>
      <span class="hljs-keyword">if</span> (input[i].type === <span class="hljs-string">"MULTI_LINE_COMMENT_START"</span>) {

        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=i; input.length; j++) {
          <span class="hljs-keyword">if</span> (input[j].type === <span class="hljs-string">"MULTI_LINE_COMMENT_END"</span>) {
            input.splice(i, j - i + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> input;<span class="hljs-comment">//TODO BUG BUG if multiple comments</span>
          }
        }
      }

    }
    <span class="hljs-keyword">return</span> input;
  },
  isNum : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^\d+.*$/</span>.test(val);
  },
  isBool : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">return</span> val === <span class="hljs-string">'true'</span> || val === <span class="hljs-string">'false'</span>;
  },
  itself : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }

};

<span class="hljs-built_in">module</span>.exports = helpers;

<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);

<span class="hljs-keyword">var</span> infix = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, id, bp, led</span>) </span>{
  <span class="hljs-keyword">var</span> s = symbol(state, originalSymbol, id, bp);
  s.led = led || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"BinaryExpression"</span>;
      <span class="hljs-keyword">this</span>.operator = <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.operator === <span class="hljs-string">"||"</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"LogicalExpression"</span>;
      }
      <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        left.type = <span class="hljs-string">"Identifier"</span>;
        left.name = left.value;
        <span class="hljs-keyword">delete</span> left.value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isNum(left.value)) {
        left.type = <span class="hljs-string">"Literal"</span>;
        left.raw = left.value;
        <span class="hljs-keyword">if</span> (left.value.indexOf(<span class="hljs-string">'.'</span>) === -<span class="hljs-number">1</span>) {
          left.value = <span class="hljs-built_in">parseFloat</span>(left.value);
        } <span class="hljs-keyword">else</span> {
          left.value = <span class="hljs-built_in">parseInt</span>(left.value);
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isBool(left.value)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Fall-through for type string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        left.type = <span class="hljs-string">"Literal"</span>;
        left.raw = <span class="hljs-string">'"'</span> + left.value + <span class="hljs-string">'"'</span>;
      }
      <span class="hljs-keyword">this</span>.left = left;
      <span class="hljs-keyword">this</span>.right = expression(state, bp);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
  <span class="hljs-keyword">return</span> s;
};

<span class="hljs-built_in">module</span>.exports = infix;
<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);

<span class="hljs-keyword">var</span> infixr = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, id, bp, led</span>) </span>{
  <span class="hljs-keyword">var</span> s = symbol(state, originalSymbol, id, bp);
  s.led = led || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"BinaryExpression"</span>;
      <span class="hljs-keyword">this</span>.operator = <span class="hljs-keyword">this</span>.value;
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.operator === <span class="hljs-string">"||"</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"LogicalExpression"</span>;
      }
      <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"IDENTIFIER"</span>) {
        left.type = <span class="hljs-string">"Identifier"</span>;
        left.name = left.value;
        <span class="hljs-keyword">delete</span> left.value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isNum(left.value)) {
        left.type = <span class="hljs-string">"Literal"</span>;
        left.raw = left.value;
        <span class="hljs-keyword">if</span> (left.value.indexOf(<span class="hljs-string">'.'</span>) === -<span class="hljs-number">1</span>) {
          left.value = <span class="hljs-built_in">parseFloat</span>(left.value);
        } <span class="hljs-keyword">else</span> {
          left.value = <span class="hljs-built_in">parseInt</span>(left.value);
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span> &amp;&amp; helpers.isBool(left.value)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>TODO type boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type === <span class="hljs-string">"literal"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Fall-through for type string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        left.type = <span class="hljs-string">"Literal"</span>;
        left.raw = <span class="hljs-string">'"'</span> + left.value + <span class="hljs-string">'"'</span>;
      }
      <span class="hljs-keyword">this</span>.left = left;
      <span class="hljs-keyword">this</span>.right = expression(state, bp - <span class="hljs-number">1</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
  <span class="hljs-keyword">return</span> s;
};

<span class="hljs-built_in">module</span>.exports = infixr;
<span class="hljs-keyword">var</span> newScope = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, originalScope</span>) </span>{

  <span class="hljs-keyword">var</span> s = state.scope;
  state.scope = <span class="hljs-built_in">Object</span>.create(originalScope);
  state.scope.def = {};
  state.scope.parent = s;
  <span class="hljs-keyword">return</span> state.scope;
};

<span class="hljs-built_in">module</span>.exports = newScope;
<span class="hljs-keyword">var</span> newScope = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, originalScope</span>) </span>{

  <span class="hljs-keyword">var</span> s = state.scope;
  state.scope = <span class="hljs-built_in">Object</span>.create(originalScope);
  state.scope.def = {};
  state.scope.parent = s;
  <span class="hljs-keyword">return</span> state.scope;
};

<span class="hljs-built_in">module</span>.exports = newScope;
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions'</span>);

<span class="hljs-keyword">var</span> originalScope = {
  define: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, n</span>) </span>{
    <span class="hljs-keyword">var</span> scope = state[<span class="hljs-string">'scope'</span>];
    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.def[n.value];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> t === <span class="hljs-string">"object"</span>) {
      <span class="hljs-built_in">console</span>.log(n.value);
      n.error(t.reserved ? <span class="hljs-string">"Already reserved."</span> : <span class="hljs-string">"Already defined."</span>);
    }
    <span class="hljs-keyword">this</span>.def[n.value] = n;
    n.reserved = <span class="hljs-literal">false</span>;
    n.nud = helpers.itself;
    n.led = <span class="hljs-literal">null</span>;
    n.std = <span class="hljs-literal">null</span>;
    n.lbp = <span class="hljs-number">0</span>;
    n.scope = scope;
    <span class="hljs-keyword">return</span> n;
  },
  <span class="hljs-keyword">delete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, n</span>) </span>{
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.def[n.value];
  },
  find: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n, symbolTable</span>) </span>{
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>,
      o;
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      o = e.def[n];
      <span class="hljs-keyword">if</span> (o &amp;&amp; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> e.def[n];
      }
      e = e.parent;
      <span class="hljs-keyword">if</span> (!e) {
        o = symbolTable[n];
        <span class="hljs-keyword">return</span> o &amp;&amp; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'function'</span> ? o : symbolTable[<span class="hljs-string">"(name)"</span>];
      }
    }
  },
  pop: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    scope = <span class="hljs-keyword">this</span>.parent;
  },
  reserve: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
    <span class="hljs-keyword">if</span> (n.type !== <span class="hljs-string">"name"</span> || n.reserved) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.def[n.value];
    <span class="hljs-keyword">if</span> (t) {
      <span class="hljs-keyword">if</span> (t.reserved) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">if</span> (t.type === <span class="hljs-string">"name"</span>) {
        n.error(<span class="hljs-string">"Already defined."</span>);
      }
    }
    <span class="hljs-keyword">this</span>.def[n.value] = n;
    n.reserved = <span class="hljs-literal">true</span>;
  }
};

<span class="hljs-built_in">module</span>.exports = originalScope;
<span class="hljs-keyword">var</span> originalSymbol = {
  nud: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.error(<span class="hljs-string">"Undefined."</span>);
  },
  led: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
    <span class="hljs-keyword">this</span>.error(<span class="hljs-string">"Missing operator."</span>);
  }
};

<span class="hljs-built_in">module</span>.exports = originalSymbol;
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions'</span>);

<span class="hljs-keyword">var</span> originalScope = {
  define: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, n</span>) </span>{
    <span class="hljs-keyword">var</span> scope = state[<span class="hljs-string">'scope'</span>];
    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.def[n.value];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> t === <span class="hljs-string">"object"</span>) {
      n.error(t.reserved ? <span class="hljs-string">"Already reserved."</span> : <span class="hljs-string">"Already defined."</span>);
    }
    <span class="hljs-keyword">this</span>.def[n.value] = n;
    n.reserved = <span class="hljs-literal">false</span>;
    n.nud = helpers.itself;
    n.led = <span class="hljs-literal">null</span>;
    n.std = <span class="hljs-literal">null</span>;
    n.lbp = <span class="hljs-number">0</span>;
    n.scope = scope;
    <span class="hljs-keyword">return</span> n;
  },
  <span class="hljs-keyword">delete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, n</span>) </span>{
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.def[n.value];
  },
  find: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n, symbolTable</span>) </span>{
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>,
      o;
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      o = e.def[n];
      <span class="hljs-keyword">if</span> (o &amp;&amp; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> e.def[n];
      }
      e = e.parent;
      <span class="hljs-keyword">if</span> (!e) {
        o = symbolTable[n];
        <span class="hljs-keyword">return</span> o &amp;&amp; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'function'</span> ? o : symbolTable[<span class="hljs-string">"(name)"</span>];
      }
    }
  },
  pop: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    scope = <span class="hljs-keyword">this</span>.parent;
  },
  reserve: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
    <span class="hljs-keyword">if</span> (n.type !== <span class="hljs-string">"name"</span> || n.reserved) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.def[n.value];
    <span class="hljs-keyword">if</span> (t) {
      <span class="hljs-keyword">if</span> (t.reserved) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">if</span> (t.type === <span class="hljs-string">"name"</span>) {
        n.error(<span class="hljs-string">"Already defined."</span>);
      }
    }
    <span class="hljs-keyword">this</span>.def[n.value] = n;
    n.reserved = <span class="hljs-literal">true</span>;
  }
};

<span class="hljs-built_in">module</span>.exports = originalScope;
<span class="hljs-keyword">var</span> original_symbol = {
  nud: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.error(<span class="hljs-string">"Undefined."</span>);
  },
  led: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left</span>) </span>{
    <span class="hljs-keyword">this</span>.error(<span class="hljs-string">"Missing operator."</span>);
  }
};

<span class="hljs-built_in">module</span>.exports = original_symbol;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> diff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'deep-diff'</span>).diff;
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions.js'</span>);
<span class="hljs-keyword">var</span> advance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./advance'</span>);
<span class="hljs-keyword">var</span> newScope = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./newScope'</span>);
<span class="hljs-keyword">var</span> originalScope = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalScope'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);
<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> block = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./block'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);
<span class="hljs-keyword">var</span> infix = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./infix'</span>);
<span class="hljs-keyword">var</span> infixr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./infixr'</span>);
<span class="hljs-keyword">var</span> assignment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./assignment'</span>);
<span class="hljs-keyword">var</span> declarations = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./declarations'</span>);
<span class="hljs-keyword">var</span> statements = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./statements'</span>);
<span class="hljs-keyword">var</span> rearrangeTokensDynamicDictionaryAssignment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rearrangeTokensDynamicDictionaryAssignment'</span>);
<span class="hljs-keyword">var</span> rearrangeTokensDictionaryKeyValueIteration = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rearrangeTokensDictionaryKeyValueIteration'</span>);
<span class="hljs-keyword">var</span> rearrangeTokensPrintToConsoleLog = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rearrangeTokensPrintToConsoleLog'</span>);
<span class="hljs-keyword">var</span> rearrangeTokensVariadicParams = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rearrangeTokensVariadicParams'</span>);
<span class="hljs-keyword">var</span> rearrangeTokensAddParens = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rearrangeTokensAddParens'</span>);

<span class="hljs-keyword">var</span> makeParser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> state = {};
  state.scope;
  state.symbolTable = {};
  state.token;
  state.tokens;
  state.index = <span class="hljs-number">0</span>;

  declarations.symbols(state);
  declarations.assignments(state);
  declarations.infixes(state);
  declarations.prefixes(state);
  declarations.stmts(state);
  declarations.constants(state);

  <span class="hljs-keyword">var</span> parseTokenStream = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">inputTokens</span>) </span>{
    <span class="hljs-keyword">var</span> intermediaryTokenStream = helpers.cleanUpTokenStream(inputTokens);
    <span class="hljs-keyword">var</span> intermediary = rearrangeTokensDynamicDictionaryAssignment(intermediaryTokenStream);
    <span class="hljs-keyword">var</span> intermediary2 = rearrangeTokensPrintToConsoleLog(intermediary);
    <span class="hljs-keyword">var</span> intermediary3 = rearrangeTokensDictionaryKeyValueIteration(intermediary2);
    <span class="hljs-keyword">var</span> intermediary4 = rearrangeTokensVariadicParams(intermediary3);
    state.tokens = rearrangeTokensAddParens(intermediary4);
    state.scope = newScope(state, originalScope);

    <span class="hljs-comment">/* Define globally accessible objects */</span>
    <span class="hljs-comment">/* console */</span>
    <span class="hljs-keyword">var</span> identifierSymbol = state.symbolTable[<span class="hljs-string">"(name)"</span>];
    <span class="hljs-keyword">var</span> identifierToken = <span class="hljs-built_in">Object</span>.create(identifierSymbol);
    identifierToken.type = <span class="hljs-string">"Identifier"</span>;
    identifierToken.value = <span class="hljs-string">"console"</span>;
    state.scope.define(state, identifierToken);

    <span class="hljs-comment">/* Array */</span>
    <span class="hljs-keyword">var</span> identifierSymbol = state.symbolTable[<span class="hljs-string">"(name)"</span>];
    <span class="hljs-keyword">var</span> identifierToken = <span class="hljs-built_in">Object</span>.create(identifierSymbol);
    identifierToken.type = <span class="hljs-string">"Identifier"</span>;
    identifierToken.value = <span class="hljs-string">"Array"</span>;
    state.scope.define(state, identifierToken);

    <span class="hljs-comment">/* arguments */</span>
    <span class="hljs-keyword">var</span> identifierSymbol = state.symbolTable[<span class="hljs-string">"(name)"</span>];
    <span class="hljs-keyword">var</span> identifierToken = <span class="hljs-built_in">Object</span>.create(identifierSymbol);
    identifierToken.type = <span class="hljs-string">"Identifier"</span>;
    identifierToken.value = <span class="hljs-string">"arguments"</span>;

    state.scope.define(state, identifierToken);

    state = advance(state);

    <span class="hljs-comment">/* Remove leading new lines */</span>
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
        state = advance(state);
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">var</span> s = statements(state);
    state = advance(state);
    state.scope.pop();

    <span class="hljs-keyword">var</span> bodyNodes;
    <span class="hljs-keyword">if</span>(s) {
      bodyNodes = <span class="hljs-built_in">Array</span>.isArray(s) ? s : [s];
    } <span class="hljs-keyword">else</span> {
      bodyNodes = [];
    }

    <span class="hljs-keyword">if</span>(bodyNodes.length &gt;= <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> q=<span class="hljs-number">0</span>; q&lt;bodyNodes.length; q++) {
        <span class="hljs-keyword">var</span> n = bodyNodes[q];
        <span class="hljs-keyword">if</span>(n.type === <span class="hljs-string">"CallExpression"</span>){
          <span class="hljs-keyword">var</span> expressionStmtWrapper = {
            type: <span class="hljs-string">"ExpressionStatement"</span>,
            expression: n
          }
          bodyNodes[q] = expressionStmtWrapper;
        }
      }
    }


    <span class="hljs-keyword">var</span> result = {
      type: <span class="hljs-string">'Program'</span>,
      sourceType: <span class="hljs-string">'module'</span>,
      body: bodyNodes
    };

    <span class="hljs-comment">/**
     * Walk result tree and remove properties that don't conform to Esprima standard.
     * * */</span>
    helpers.traverse(result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">currentNode</span>) </span>{
      helpers.deletePropertyIfExists(currentNode, [<span class="hljs-string">'reserved'</span>, <span class="hljs-string">'nud'</span>, <span class="hljs-string">'led'</span>, <span class="hljs-string">'std'</span>, <span class="hljs-string">'lbp'</span>, <span class="hljs-string">'scope'</span>, <span class="hljs-string">'assignment'</span>]);
    });

    <span class="hljs-keyword">return</span> result;
  };

  <span class="hljs-keyword">return</span> parseTokenStream;
};

<span class="hljs-built_in">module</span>.exports = makeParser;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> diff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'deep-diff'</span>).diff;
<span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helperFunctions.js'</span>);
<span class="hljs-keyword">var</span> makeParse = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./parser'</span>);

<span class="hljs-keyword">var</span> expected = {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Program"</span>,
  <span class="hljs-string">"body"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"FunctionDeclaration"</span>,
      <span class="hljs-string">"id"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"returnWorld"</span>
      },
      <span class="hljs-string">"params"</span>: [],
      <span class="hljs-string">"defaults"</span>: [],
      <span class="hljs-string">"body"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"BlockStatement"</span>,
        <span class="hljs-string">"body"</span>: [
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"ReturnStatement"</span>,
            <span class="hljs-string">"argument"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"Literal"</span>,
              <span class="hljs-string">"value"</span>: <span class="hljs-string">"World"</span>,
              <span class="hljs-string">"raw"</span>: <span class="hljs-string">"\"World\""</span>
            }
          }
        ]
      },
      <span class="hljs-string">"generator"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"expression"</span>: <span class="hljs-literal">false</span>
    },
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"FunctionDeclaration"</span>,
      <span class="hljs-string">"id"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"printInput"</span>
      },
      <span class="hljs-string">"params"</span>: [
        {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"input"</span>
        }
      ],
      <span class="hljs-string">"defaults"</span>: [],
      <span class="hljs-string">"body"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"BlockStatement"</span>,
        <span class="hljs-string">"body"</span>: [
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"ExpressionStatement"</span>,
            <span class="hljs-string">"expression"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"CallExpression"</span>,
              <span class="hljs-string">"callee"</span>: {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"MemberExpression"</span>,
                <span class="hljs-string">"computed"</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-string">"object"</span>: {
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
                  <span class="hljs-string">"name"</span>: <span class="hljs-string">"console"</span>
                },
                <span class="hljs-string">"property"</span>: {
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
                  <span class="hljs-string">"name"</span>: <span class="hljs-string">"log"</span>
                }
              },
              <span class="hljs-string">"arguments"</span>: [
                {
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
                  <span class="hljs-string">"name"</span>: <span class="hljs-string">"input"</span>
                }
              ]
            }
          }
        ]
      },
      <span class="hljs-string">"generator"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"expression"</span>: <span class="hljs-literal">false</span>
    },
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"ExpressionStatement"</span>,
      <span class="hljs-string">"expression"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"CallExpression"</span>,
        <span class="hljs-string">"callee"</span>: {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"printInput"</span>
        },
        <span class="hljs-string">"arguments"</span>: [
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"BinaryExpression"</span>,
            <span class="hljs-string">"operator"</span>: <span class="hljs-string">"+"</span>,
            <span class="hljs-string">"left"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"BinaryExpression"</span>,
              <span class="hljs-string">"operator"</span>: <span class="hljs-string">"+"</span>,
              <span class="hljs-string">"left"</span>: {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"Literal"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"Hello, "</span>,
                <span class="hljs-string">"raw"</span>: <span class="hljs-string">"\"Hello, \""</span>
              },
              <span class="hljs-string">"right"</span>: {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"CallExpression"</span>,
                <span class="hljs-string">"callee"</span>: {
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Identifier"</span>,
                  <span class="hljs-string">"name"</span>: <span class="hljs-string">"returnWorld"</span>
                },
                <span class="hljs-string">"arguments"</span>: []
              }
            },
            <span class="hljs-string">"right"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"Literal"</span>,
              <span class="hljs-string">"value"</span>: <span class="hljs-string">"!"</span>,
              <span class="hljs-string">"raw"</span>: <span class="hljs-string">"\"!\""</span>
            }
          }
        ]
      }
    }
  ],
  <span class="hljs-string">"sourceType"</span>: <span class="hljs-string">"module"</span>
};
<span class="hljs-keyword">var</span> tokenStream = [
  { type: <span class="hljs-string">'DECLARATION_KEYWORD'</span>, value: <span class="hljs-string">'func'</span> },
  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'returnWorld'</span> },
  { type: <span class="hljs-string">'PARAMS_START'</span>, value: <span class="hljs-string">'('</span> },
  { type: <span class="hljs-string">'PARAMS_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'RETURN_ARROW'</span>, value: <span class="hljs-string">'-&gt;'</span> },
  { type: <span class="hljs-string">'TYPE_STRING'</span>, value: <span class="hljs-string">'String'</span> },
  { type: <span class="hljs-string">'STATEMENTS_START'</span>, value: <span class="hljs-string">'{'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'STATEMENT_KEYWORD'</span>, value: <span class="hljs-string">'return'</span> },
  { type: <span class="hljs-string">'STRING'</span>, value: <span class="hljs-string">'World'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'STATEMENTS_END'</span>, value: <span class="hljs-string">'}'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'DECLARATION_KEYWORD'</span>, value: <span class="hljs-string">'func'</span> },
  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'printInput'</span> },
  { type: <span class="hljs-string">'PARAMS_START'</span>, value: <span class="hljs-string">'('</span> },
  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'input'</span> },
  { type: <span class="hljs-string">'PUNCTUATION'</span>, value: <span class="hljs-string">':'</span> },
  { type: <span class="hljs-string">'TYPE_STRING'</span>, value: <span class="hljs-string">'String'</span> },
  { type: <span class="hljs-string">'PARAMS_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'STATEMENTS_START'</span>, value: <span class="hljs-string">'{'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'NATIVE_METHOD'</span>, value: <span class="hljs-string">'print'</span> },
  { type: <span class="hljs-string">'INVOCATION_START'</span>, value: <span class="hljs-string">'('</span> },
  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'input'</span> },
  { type: <span class="hljs-string">'INVOCATION_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'STATEMENTS_END'</span>, value: <span class="hljs-string">'}'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'\\n'</span> },

  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'printInput'</span> },
  { type: <span class="hljs-string">'INVOCATION_START'</span>, value: <span class="hljs-string">'('</span> },
  { type: <span class="hljs-string">'STRING'</span>, value: <span class="hljs-string">'Hello, '</span> },
  { type: <span class="hljs-string">'STRING_INTERPOLATION_START'</span>, value: <span class="hljs-string">'\\('</span> },
  { type: <span class="hljs-string">'IDENTIFIER'</span>, value: <span class="hljs-string">'returnWorld'</span> },
  { type: <span class="hljs-string">'INVOCATION_START'</span>, value: <span class="hljs-string">'('</span> },
  { type: <span class="hljs-string">'INVOCATION_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'STRING_INTERPOLATION_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'STRING'</span>, value: <span class="hljs-string">'!'</span> },
  { type: <span class="hljs-string">'INVOCATION_END'</span>, value: <span class="hljs-string">')'</span> },
  { type: <span class="hljs-string">'TERMINATOR'</span>, value: <span class="hljs-string">'EOF'</span> }
];
<span class="hljs-keyword">var</span> parser = makeParse();

<span class="hljs-comment">/**
 * First time
 */</span>

<span class="hljs-keyword">var</span> actual = parser(tokenStream);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##### BEGIN AST OUTPUT #####"</span>);
<span class="hljs-built_in">console</span>.log(util.inspect(actual, {
  colors: <span class="hljs-literal">true</span>,
  depth: <span class="hljs-literal">null</span>
}));
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(util.inspect(expected, {
  colors: <span class="hljs-literal">true</span>,
  depth: <span class="hljs-literal">null</span>
}));
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"############################"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"########## DIFF ############"</span>);
<span class="hljs-keyword">var</span> dfrnc = diff(actual,expected);
<span class="hljs-built_in">console</span>.log(dfrnc);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>var escodegen = require(‘escodegen’);
console.log(‘JSJSJSJSJSJSJSJSJSJSJSJSJSJSJS’);
console.log(escodegen.generate(expected));
console.log(‘JSJSJSJSJSJSJSJSJSJSJSJSJSJSJS’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);

<span class="hljs-keyword">var</span> prefix = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, id, nud</span>) </span>{
  <span class="hljs-keyword">var</span> s = symbol(state, originalSymbol, id);
  s.nud = nud || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      state.scope.reserve(<span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value === <span class="hljs-string">"++"</span> || <span class="hljs-keyword">this</span>.value === <span class="hljs-string">"--"</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"UpdateExpression"</span>;
        <span class="hljs-keyword">this</span>.operator = <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">this</span>.prefix = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.argument = expression(state, <span class="hljs-number">70</span>);
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.value === <span class="hljs-string">"--"</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"UpdateExpression"</span>;
        <span class="hljs-keyword">this</span>.operator = <span class="hljs-string">"--"</span>;
        <span class="hljs-keyword">this</span>.prefix = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.argument = expression(state, <span class="hljs-number">70</span>);
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value === <span class="hljs-string">"+"</span>) {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"UnaryExpression"</span>;
        <span class="hljs-keyword">this</span>.prefix = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.operator = <span class="hljs-string">"+"</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.type = <span class="hljs-string">"UnaryExpression"</span>;
        <span class="hljs-keyword">this</span>.operator = <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.value;
        <span class="hljs-keyword">this</span>.argument = expression(state, <span class="hljs-number">70</span>);
        <span class="hljs-keyword">this</span>.prefix = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;

    };
  <span class="hljs-keyword">return</span> s;
};

<span class="hljs-built_in">module</span>.exports = prefix;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">var</span> rearrangeTokensAddParens = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokens</span>) </span>{

  <span class="hljs-keyword">var</span> reformat = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> ifStatements = [];

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;tokens.length; i++) {
    <span class="hljs-keyword">if</span>(tokens[i].value === <span class="hljs-string">"if"</span> &amp;&amp; tokens[i].type === <span class="hljs-string">"STATEMENT_KEYWORD"</span>) {
      reformat = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> ifStatement = {
        ifIdx: i
      };
      <span class="hljs-keyword">var</span> j = i;
      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        j++;
        <span class="hljs-keyword">if</span> (tokens[j].value === <span class="hljs-string">'{'</span>) {
          ifStatement.curlyIdx = j;
          <span class="hljs-keyword">break</span>;
        }
      }
      ifStatements.push(ifStatement);
    }
  }

  <span class="hljs-keyword">if</span>(reformat) {
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> m=ifStatements.length-<span class="hljs-number">1</span>; m &gt;= <span class="hljs-number">0</span>; m--) {
      <span class="hljs-keyword">var</span> currentIfStmt = ifStatements[m];
      tokens.splice(currentIfStmt.ifIdx + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, { type: <span class="hljs-string">"PUNCTUATION"</span>,         value: <span class="hljs-string">"("</span> });
      tokens.splice(currentIfStmt.curlyIdx + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, { type: <span class="hljs-string">"PUNCTUATION"</span>,         value: <span class="hljs-string">")"</span> });
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>console.log(util.inspect(tokens, {colors:true, depth:null}));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> tokens;
};

<span class="hljs-built_in">module</span>.exports = rearrangeTokensAddParens;


<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">var</span> rearrangeTokensDictionaryKeyValueIteration = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokens</span>) </span>{

  <span class="hljs-keyword">var</span> reformat = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> identifierKey = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> identifierVal = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> identifierCol = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> insertAt = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> indicesOfTokensToRemove = [];
  <span class="hljs-keyword">var</span> indexToAddVarKeyword = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> indexToAddEndParensToken = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;tokens.length; i++) {
    <span class="hljs-keyword">if</span>(tokens[i].value === <span class="hljs-string">"for"</span> &amp;&amp; tokens[i].type === <span class="hljs-string">"STATEMENT_KEYWORD"</span>) {
      <span class="hljs-comment">/* keyword:for is followed by #(; #var; #,; #var; #); #in; #var */</span>
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">1</span>].type !== <span class="hljs-string">"PUNCTUATION"</span> &amp;&amp; tokens[i+<span class="hljs-number">1</span>].value !== <span class="hljs-string">"("</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">2</span>].type !== <span class="hljs-string">"IDENTIFIER"</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">3</span>].type !== <span class="hljs-string">"PUNCTUATION"</span> &amp;&amp; tokens[i+<span class="hljs-number">3</span>].value !== <span class="hljs-string">","</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">4</span>].type !== <span class="hljs-string">"IDENTIFIER"</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">5</span>].type !== <span class="hljs-string">"PUNCTUATION"</span> &amp;&amp; tokens[i+<span class="hljs-number">5</span>].value !== <span class="hljs-string">")"</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">6</span>].type !== <span class="hljs-string">"STATEMENT_KEYWORD"</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">7</span>].type !== <span class="hljs-string">"IDENTIFIER"</span>) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span>(tokens[i+<span class="hljs-number">8</span>].type !== <span class="hljs-string">"PUNCTUATION"</span> &amp;&amp; tokens[i+<span class="hljs-number">8</span>].value !== <span class="hljs-string">"{"</span>) <span class="hljs-keyword">continue</span>;
      reformat = <span class="hljs-literal">true</span>;
      identifierKey = tokens[i+<span class="hljs-number">2</span>].value;
      identifierVal = tokens[i+<span class="hljs-number">4</span>].value;
      identifierCol = tokens[i+<span class="hljs-number">7</span>].value;
      insertAt = i+<span class="hljs-number">9</span>;
      indicesOfTokensToRemove.push(i+<span class="hljs-number">3</span>);
      indicesOfTokensToRemove.push(i+<span class="hljs-number">4</span>);
      indicesOfTokensToRemove.push(i+<span class="hljs-number">5</span>);
      indexToAddVarKeyword = i+<span class="hljs-number">2</span>;
      indexToAddEndParensToken = i+<span class="hljs-number">6</span>;
    }
  }

  <span class="hljs-keyword">if</span>(reformat) {

    tokens.splice(insertAt, <span class="hljs-number">0</span>,
      { type: <span class="hljs-string">"DECLARATION_KEYWORD"</span>, value: <span class="hljs-string">"var"</span> },
      { type: <span class="hljs-string">"IDENTIFIER"</span>, value: identifierVal },
      { type: <span class="hljs-string">"OPERATOR"</span>, value: <span class="hljs-string">"="</span> },
      { type: <span class="hljs-string">"IDENTIFIER"</span>, value: identifierCol },
      { type: <span class="hljs-string">"SUBSCRIPT_LOOKUP_START"</span>, value: <span class="hljs-string">"["</span> },
      { type: <span class="hljs-string">"IDENTIFIER"</span>, value: identifierKey },
      { type: <span class="hljs-string">"SUBSCRIPT_LOOKUP_END"</span>, value: <span class="hljs-string">"]"</span> },
      { type: <span class="hljs-string">"PUNCTUATION"</span>, value: <span class="hljs-string">";"</span> });
    tokens.splice(indicesOfTokensToRemove[<span class="hljs-number">0</span>], indicesOfTokensToRemove.length);
    tokens.splice(indexToAddEndParensToken-<span class="hljs-number">3</span>, <span class="hljs-number">0</span>,
      { type: <span class="hljs-string">'PUNCTUATION'</span>, value: <span class="hljs-string">')'</span> });
    tokens.splice(indexToAddVarKeyword, <span class="hljs-number">0</span>,
      { type: <span class="hljs-string">"DECLARATION_KEYWORD"</span>, value: <span class="hljs-string">"var"</span> });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>console.log(util.inspect(tokens, {colors:true, depth:null}));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> tokens;
};

<span class="hljs-built_in">module</span>.exports = rearrangeTokensDictionaryKeyValueIteration;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">var</span> rearrangeTokensDynamicDictionaryAssignment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokensArray</span>) </span>{

  <span class="hljs-keyword">var</span> start = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> end = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> identifierName;

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;tokensArray.length; i++) {
    <span class="hljs-keyword">var</span> token = tokensArray[i];
    <span class="hljs-keyword">if</span>(token.type === <span class="hljs-string">"DICTIONARY_START"</span>) {
      start = i;
      identifierName = tokensArray[i-<span class="hljs-number">2</span>].value;
    }
    <span class="hljs-keyword">if</span>(token.type === <span class="hljs-string">"DICTIONARY_END"</span>) {
      end = i;
    }
  }

  <span class="hljs-keyword">if</span>(end === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> tokensArray;
  }

  <span class="hljs-keyword">var</span> dictionaryContents = tokensArray.slice(start+<span class="hljs-number">1</span>, end);
  <span class="hljs-keyword">var</span> kvDelim = [];
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;dictionaryContents.length; i++) {
    <span class="hljs-keyword">var</span> token = dictionaryContents[i];
    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">":"</span> &amp;&amp; token.type === <span class="hljs-string">"PUNCTUATION"</span>) {
      <span class="hljs-keyword">if</span>(i === <span class="hljs-number">0</span> &amp;&amp; !dictionaryContents[i-<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">return</span> tokensArray;
      }
      <span class="hljs-keyword">if</span>(dictionaryContents[i-<span class="hljs-number">1</span>].type === <span class="hljs-string">"IDENTIFIER"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>the variable is the key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        kvDelim.push({ colonIdx: i, keyIdx: i-<span class="hljs-number">1</span> });
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(dictionaryContents[i-<span class="hljs-number">1</span>].value === <span class="hljs-string">"]"</span> &amp;&amp; dictionaryContents[i-<span class="hljs-number">3</span>].value === <span class="hljs-string">"["</span> &amp;&amp; dictionaryContents[i-<span class="hljs-number">4</span>].type === <span class="hljs-string">"IDENTIFIER"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>property lookup is the key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        kvDelim.push({ colonIdx: i, keyIdx: i-<span class="hljs-number">4</span> });
      }
    }
  }

  <span class="hljs-keyword">if</span>(kvDelim.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> tokensArray;
  }

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;kvDelim.length; i++) {
    <span class="hljs-keyword">var</span> obj = kvDelim[i];
    <span class="hljs-keyword">var</span> idx = obj.keyIdx;
    <span class="hljs-keyword">if</span>( ( idx - <span class="hljs-number">1</span> ) &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>(dictionaryContents[idx-<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">if</span>(dictionaryContents[idx-<span class="hljs-number">1</span>].value === <span class="hljs-string">","</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Swap comma token for semi-colon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          dictionaryContents[idx-<span class="hljs-number">1</span>].value = <span class="hljs-string">";"</span>;
        }
      }
    }
  }

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;kvDelim.length; i++) {
    <span class="hljs-keyword">var</span> obj = kvDelim[i];
    <span class="hljs-keyword">var</span> idx = obj.colonIdx;
    <span class="hljs-keyword">if</span>(dictionaryContents[idx]) {
      <span class="hljs-keyword">if</span>(dictionaryContents[idx].value === <span class="hljs-string">":"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Swap colon for equal sign.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dictionaryContents[idx].value = <span class="hljs-string">"="</span>;
        dictionaryContents[idx].type = <span class="hljs-string">"OPERATOR"</span>;
      }
    }
  }

  <span class="hljs-keyword">var</span> ranges = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>split dictionaryContents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;kvDelim.length; i++) {
    <span class="hljs-keyword">var</span> kvpairObj = kvDelim[i];
    <span class="hljs-keyword">var</span> kvStart = kvpairObj.keyIdx;
    <span class="hljs-keyword">var</span> kvStop;
    <span class="hljs-keyword">if</span>(kvDelim[i+<span class="hljs-number">1</span>]) {
      kvStop = kvDelim[i+<span class="hljs-number">1</span>].keyIdx - <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
      kvStop = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">if</span>(kvStop === <span class="hljs-literal">null</span>) {
      ranges.push({ start: kvStart });
    } <span class="hljs-keyword">else</span> {
      ranges.push({ start: kvStart, stop: kvStop });
    }

  }

  <span class="hljs-keyword">var</span> kvps = [];
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;ranges.length; i++) {
    <span class="hljs-keyword">var</span> range = ranges[i];
    <span class="hljs-keyword">if</span>(range.kvStop) {
      <span class="hljs-keyword">var</span> kvp = dictionaryContents.slice(range.start);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> kvp = dictionaryContents.slice(range.start, range.stop);
    }
    kvps.push(kvp);
  }

  <span class="hljs-keyword">var</span> statements = [];
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;kvDelim.length; i++) {
    <span class="hljs-keyword">var</span> currentArray = [];
    currentArray.push({ type: <span class="hljs-string">"IDENTIFIER"</span>, value: identifierName });
    currentArray.push({ type: <span class="hljs-string">"PUNCTUATION"</span>, value: <span class="hljs-string">"["</span> });

    <span class="hljs-keyword">var</span> sequence = kvps[i];
    <span class="hljs-keyword">var</span> endKeyIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> z=<span class="hljs-number">0</span>; z&lt;sequence.length; z++) {
      <span class="hljs-keyword">if</span>(sequence[z].value === <span class="hljs-string">"="</span>) {
        endKeyIndex = z;
        <span class="hljs-keyword">break</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>insert key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> keyArray = sequence.slice(<span class="hljs-number">0</span>,endKeyIndex);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;keyArray.length; j++) {
      currentArray.push(keyArray[j]);
    }
    currentArray.push({ type: <span class="hljs-string">"PUNCTUATION"</span>, value: <span class="hljs-string">"]"</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>insert the rest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> valArray = sequence.slice(endKeyIndex);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;valArray.length; j++) {
      currentArray.push(valArray[j]);
    }

    statements.push(currentArray);
  }

  <span class="hljs-keyword">var</span> throughDeclaration = tokensArray.slice(<span class="hljs-number">0</span>, start+<span class="hljs-number">1</span>);
  <span class="hljs-keyword">var</span> dictEndThroughEnd = tokensArray.slice(end);

  <span class="hljs-keyword">var</span> finalOutputArray = [];

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;throughDeclaration.length; i++) {
    finalOutputArray.push(throughDeclaration[i]);
  }
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;dictEndThroughEnd.length; i++) {
    <span class="hljs-keyword">if</span>(i===<span class="hljs-number">0</span>) {
      finalOutputArray.push(dictEndThroughEnd[i]);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i===<span class="hljs-number">1</span>) {
      finalOutputArray.push(dictEndThroughEnd[i]);
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;statements.length; j++) {
        <span class="hljs-keyword">var</span> statement = statements[j];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> k=<span class="hljs-number">0</span>; k&lt;statement.length; k++) {
          <span class="hljs-keyword">var</span> item = statement[k];
          finalOutputArray.push(item);
          <span class="hljs-keyword">if</span>(k === statement.length - <span class="hljs-number">1</span>) {
            finalOutputArray.push({ type: <span class="hljs-string">"PUNCTUATION"</span>, value: <span class="hljs-string">";"</span> });
          }
        }
      }
    } <span class="hljs-keyword">else</span> {
      finalOutputArray.push(dictEndThroughEnd[i]);
    }
  }

  <span class="hljs-keyword">return</span> finalOutputArray;
};

<span class="hljs-built_in">module</span>.exports = rearrangeTokensDynamicDictionaryAssignment;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">var</span> rearrangeTokensPrintToConsoleLog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokens</span>) </span>{

  <span class="hljs-keyword">var</span> reformat = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> nativePrintIndices = [];

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;tokens.length; i++) {
    <span class="hljs-keyword">if</span>(tokens[i].value === <span class="hljs-string">"print"</span> &amp;&amp; tokens[i].type === <span class="hljs-string">"NATIVE_METHOD"</span>) {
      reformat = <span class="hljs-literal">true</span>;
      nativePrintIndices.push(i);
    }
  }

  <span class="hljs-keyword">if</span>(reformat) {
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=nativePrintIndices.length - <span class="hljs-number">1</span>; j&gt;=<span class="hljs-number">0</span>; j--) {
      <span class="hljs-keyword">var</span> index = nativePrintIndices[j];
      tokens.splice(index, <span class="hljs-number">1</span>,
        { type: <span class="hljs-string">"IDENTIFIER"</span>,         value: <span class="hljs-string">"console"</span> },
        { type: <span class="hljs-string">"OPERATOR"</span>,           value: <span class="hljs-string">"."</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,         value: <span class="hljs-string">"log"</span> });
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>console.log(util.inspect(tokens, {colors:true, depth:null}));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> tokens;
};

<span class="hljs-built_in">module</span>.exports = rearrangeTokensPrintToConsoleLog;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">var</span> rearrangeTokensVariadicParams = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokens</span>) </span>{

  <span class="hljs-keyword">var</span> reformat = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> paramName = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> openBlock = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;tokens.length; i++) {
    <span class="hljs-keyword">if</span>(tokens[i].value === <span class="hljs-string">"..."</span> &amp;&amp; tokens[i].type === <span class="hljs-string">"VARIADIC_PARAM"</span>) {
      reformat = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> lookBack = i;
      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        lookBack--;
        <span class="hljs-keyword">if</span> (tokens[lookBack].value === <span class="hljs-string">','</span> || tokens[lookBack].value === <span class="hljs-string">'('</span>) {
          <span class="hljs-keyword">break</span>;
        }
      }
      <span class="hljs-keyword">var</span> lookAhead = i;
      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        lookAhead++;
        <span class="hljs-keyword">if</span> (tokens[lookAhead].value === <span class="hljs-string">','</span> || tokens[lookAhead].value === <span class="hljs-string">')'</span>) {
          <span class="hljs-keyword">break</span>;
        }
      }
      openBlock = i;
      <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        openBlock++;
        <span class="hljs-keyword">if</span> (tokens[openBlock].value === <span class="hljs-string">'{'</span>) {
          <span class="hljs-keyword">break</span>;
        }
      }
      paramName = tokens[lookBack + <span class="hljs-number">1</span>].value;
      tokens.splice(lookBack + <span class="hljs-number">1</span>, (lookAhead - lookBack - <span class="hljs-number">1</span>));
    }
  }

  <span class="hljs-keyword">if</span>(reformat) {
      tokens.splice(openBlock - <span class="hljs-number">2</span>, <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>TODO insert var numbers = Array.prototype.slice.call(arguments[arguments.length-1]);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        { type: <span class="hljs-string">"DECLARATION_KEYWORD"</span>,  value: <span class="hljs-string">"var"</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: paramName },<span class="hljs-comment">//Identifier</span>
        { type: <span class="hljs-string">"OPERATOR"</span>,             value: <span class="hljs-string">"="</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"Array"</span> },<span class="hljs-comment">//Add to scope obj</span>
        { type: <span class="hljs-string">"DOT_SYNTAX"</span>,           value: <span class="hljs-string">"."</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"prototype"</span> },<span class="hljs-comment">//Add to scope obj</span>
        { type: <span class="hljs-string">"DOT_SYNTAX"</span>,           value: <span class="hljs-string">"."</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"slice"</span> },
        { type: <span class="hljs-string">"DOT_SYNTAX"</span>,           value: <span class="hljs-string">"."</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"call"</span> },
        { type: <span class="hljs-string">"INVOCATION_START"</span>,     value: <span class="hljs-string">"("</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"arguments"</span> },<span class="hljs-comment">//Add to scope obj</span>
        { type: <span class="hljs-string">"SUBSTRING_LOOKUP_START"</span>,value: <span class="hljs-string">"["</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"arguments"</span> },
        { type: <span class="hljs-string">"DOT_SYNTAX"</span>,           value: <span class="hljs-string">"."</span> },
        { type: <span class="hljs-string">"IDENTIFIER"</span>,           value: <span class="hljs-string">"length"</span> },<span class="hljs-comment">//Add to scope obj</span>
        { type: <span class="hljs-string">"OPERATOR"</span>,             value: <span class="hljs-string">"-"</span> },
        { type: <span class="hljs-string">"NUMBER"</span>,               value: <span class="hljs-string">"1"</span> },
        { type: <span class="hljs-string">"SUBSTRING_LOOKUP_END"</span>, value: <span class="hljs-string">"]"</span> },
        { type: <span class="hljs-string">"INVOCATION_END"</span>,       value: <span class="hljs-string">")"</span> },
        { type: <span class="hljs-string">"PUNCTUATION"</span>,          value: <span class="hljs-string">";"</span> },
        { type: <span class="hljs-string">"TERMINATOR"</span>,           value: <span class="hljs-string">"\\n"</span> });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>console.log(util.inspect(tokens, {colors:true, depth:null}));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> tokens;
};

<span class="hljs-built_in">module</span>.exports = rearrangeTokensVariadicParams;

<span class="hljs-keyword">var</span> advance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./advance'</span>);
<span class="hljs-keyword">var</span> expression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./expression'</span>);

<span class="hljs-keyword">var</span> statement = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{

  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
      state = advance(state);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">var</span> n = state.token, v;

  <span class="hljs-keyword">if</span> (n.std) {
    state = advance(state);
    state.scope.reserve(n);
    <span class="hljs-keyword">var</span> statementResultNode = n.std();
    <span class="hljs-keyword">return</span> statementResultNode;
  }


  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">";"</span>) {
    state = advance(state);
  }
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
      state = advance(state);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>;
    }
  }
  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"}"</span>) {
    <span class="hljs-keyword">return</span> v;
  }
  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"EOF"</span>) {
    <span class="hljs-keyword">return</span> v;
  }

  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"-&gt;"</span>) {
    state = advance(state);
    state = advance(state);
  }

  v = expression(state, <span class="hljs-number">0</span>);

  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">";"</span>) {
    state = advance(state);
  }
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"\\n"</span>) {
      state = advance(state);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>;
    }
  }
  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"}"</span>) {
    <span class="hljs-keyword">return</span> v;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>while (true) {
 if (![‘;’, ‘\n’, ‘)’].hasItem(state.token.value)) {
   state = advance(state);
 } else {
   break;
 }
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (state.token.value === <span class="hljs-string">')'</span>) {
    state = advance(state);
  }

  <span class="hljs-keyword">if</span>(state.token.value === <span class="hljs-string">"EOF"</span>) {
    <span class="hljs-keyword">return</span> v;
  } <span class="hljs-keyword">if</span>(v.type === <span class="hljs-string">"FunctionDeclaration"</span>) {
    <span class="hljs-keyword">return</span> v;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!v.assignment &amp;&amp; v.id !== <span class="hljs-string">"("</span> &amp;&amp; state.token.value !== <span class="hljs-string">"console"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>console.log(state.token);
console.log(v);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    v.error(<span class="hljs-string">"Bad expression statement."</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>state = advance(state, “;”);
state = advance(state);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">return</span> v;
};

<span class="hljs-built_in">module</span>.exports = statement;
<span class="hljs-keyword">var</span> statement = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./statement'</span>);

<span class="hljs-keyword">var</span> statements = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, optionalNumLoops, breakIfEndParen</span>) </span>{
  <span class="hljs-keyword">var</span> a = [], s, count = <span class="hljs-number">0</span>;
  breakIfEndParen = breakIfEndParen || <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span>(count &gt;= optionalNumLoops) {
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">";"</span>) {
      a.push( { <span class="hljs-string">"type"</span>: <span class="hljs-string">"EmptyStatement"</span> } );
      <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">"}"</span> || state.token.id === <span class="hljs-string">"(end)"</span> || state.token.id === <span class="hljs-string">"EOF"</span>) {
      <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (breakIfEndParen) {
      <span class="hljs-keyword">if</span> (state.token.id === <span class="hljs-string">')'</span>) {
        <span class="hljs-keyword">break</span>;
      }
    }
    s = statement(state);
    <span class="hljs-keyword">if</span> (s) {
      a.push(s);
      count++;
    }
  }
  <span class="hljs-keyword">return</span> a.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : a.length === <span class="hljs-number">1</span> ? a[<span class="hljs-number">0</span>] : a;
};

<span class="hljs-built_in">module</span>.exports = statements;
<span class="hljs-keyword">var</span> symbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./symbol'</span>);
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);

<span class="hljs-keyword">var</span> stmt = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, s, f</span>) </span>{
  <span class="hljs-keyword">var</span> x = symbol(state, originalSymbol, s);
  x.std = f;
  <span class="hljs-keyword">return</span> x;
};

<span class="hljs-built_in">module</span>.exports = stmt;
<span class="hljs-keyword">var</span> originalSymbol = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./originalSymbol'</span>);

<span class="hljs-keyword">var</span> symbol = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, originalSymbol, id, bp</span>) </span>{
  <span class="hljs-keyword">var</span> s = state.symbolTable[id];
  bp = bp || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (s) {
    <span class="hljs-keyword">if</span> (bp &gt;= s.lbp) {
      s.lbp = bp;
    }
  } <span class="hljs-keyword">else</span> {
    s = <span class="hljs-built_in">Object</span>.create(originalSymbol);
    s.id = s.value = id;
    s.lbp = bp;
    state.symbolTable[id] = s;
  }
  <span class="hljs-keyword">return</span> s;
};

<span class="hljs-built_in">module</span>.exports = symbol;
<span class="hljs-built_in">Array</span>.prototype.hasItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.indexOf(val) &gt; -<span class="hljs-number">1</span>;
};

<span class="hljs-built_in">module</span>.exports = {
  terminator : [
    <span class="hljs-string">"ARRAY_END"</span>,
    <span class="hljs-string">"DICTIONARY_END"</span>,
    <span class="hljs-string">"TUPLE_END"</span>,
    <span class="hljs-string">"TERMINATOR"</span>
  ],
  primitive : [
    <span class="hljs-string">"NUMBER"</span>,
    <span class="hljs-string">"BOOLEAN"</span>,
    <span class="hljs-string">"STRING"</span>
  ],
  collectionStart : [
    <span class="hljs-string">"ARRAY_START"</span>,
    <span class="hljs-string">"DICTIONARY_START"</span>,
    <span class="hljs-string">"TUPLE_START"</span>
  ],
  verb : [
    <span class="hljs-string">"PARAMS_START"</span>,
    <span class="hljs-string">"PARAMS_END"</span>,
    <span class="hljs-string">"STATEMENTS_START"</span>,
    <span class="hljs-string">"STATEMENTS_END"</span>,
    <span class="hljs-string">"INVOCATION_START"</span>,
    <span class="hljs-string">"INVOCATION_END"</span>,
    <span class="hljs-string">"PUNCTUATION"</span>,
    <span class="hljs-string">"OPERATOR"</span>,
    <span class="hljs-string">"SUBSTRING_LOOKUP_END"</span>,
    <span class="hljs-string">"SUBSTRING_LOOKUP_START"</span>,
    <span class="hljs-string">"SUBSCRIPT_LOOKUP_START"</span>,
    <span class="hljs-string">"SUBSCRIPT_LOOKUP_END"</span>,
    <span class="hljs-string">"DOT_SYNTAX"</span>

  ],
  noun : [
    <span class="hljs-string">"DECLARATION_KEYWORD"</span>,
    <span class="hljs-string">"IDENTIFIER"</span>,
    <span class="hljs-string">"TUPLE_ELEMENT_NAME"</span>,
    <span class="hljs-string">"STATEMENT_KEYWORD"</span>,
    <span class="hljs-string">"TYPE_BOOLEAN"</span>,
    <span class="hljs-string">"TYPE_NUMBER"</span>,
    <span class="hljs-string">"TYPE_STRING"</span>,
    <span class="hljs-string">"RETURN_ARROW"</span>,
    <span class="hljs-string">"VARIADIC_PARAM"</span>
  ],
  comment : [
    <span class="hljs-string">"COMMENT_START"</span>,
    <span class="hljs-string">"COMMENT"</span>,
    <span class="hljs-string">"MULTI_LINE_COMMENT_START"</span>,
    <span class="hljs-string">"MULTI_LINE_COMMENT_END"</span>
  ]
};



<span class="hljs-built_in">Array</span>.prototype.hasItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.indexOf(val) &gt; -<span class="hljs-number">1</span>;
};

<span class="hljs-built_in">module</span>.exports = {
  terminator : [<span class="hljs-string">"ARRAY_END"</span>, <span class="hljs-string">"DICTIONARY_END"</span>, <span class="hljs-string">"TUPLE_END"</span>, <span class="hljs-string">"TERMINATOR"</span>],
  primitive : [<span class="hljs-string">"NUMBER"</span>, <span class="hljs-string">"BOOLEAN"</span>, <span class="hljs-string">"STRING"</span>],
  collectionStart : [<span class="hljs-string">"ARRAY_START"</span>, <span class="hljs-string">"DICTIONARY_START"</span>, <span class="hljs-string">"TUPLE_START"</span>],
  verb : [<span class="hljs-string">"PUNCTUATION"</span>, <span class="hljs-string">"OPERATOR"</span>, <span class="hljs-string">"SUBSTRING_LOOKUP_END"</span>, <span class="hljs-string">"SUBSTRING_LOOKUP_START"</span>],
  noun : [<span class="hljs-string">"DECLARATION_KEYWORD"</span>, <span class="hljs-string">"IDENTIFIER"</span>, <span class="hljs-string">"TUPLE_ELEMENT_NAME"</span>, <span class="hljs-string">"STATEMENT_KEYWORD"</span>]
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
